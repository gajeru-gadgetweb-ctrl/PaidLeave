<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‰çµ¦ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒªã‚»ãƒƒãƒˆ & ãƒ™ãƒ¼ã‚¹è¨­å®š
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: #f7f9fa;
            color: #333333;
            line-height: 1.8;
            letter-spacing: 0.02em;
            font-weight: 500;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šå·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ + å³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            width: 220px;
            background: #ffffff;
            padding: 32px 0 0 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            margin-bottom: 8px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            color: #1a1a1a;
            letter-spacing: 0.02em;
        }

        .sidebar-subtitle {
            font-size: 13px;
            color: #666666;
            margin-top: 6px;
            font-weight: 500;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 2px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 11px 24px;
            color: #333333;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            position: relative;
        }

        .sidebar-nav a:hover {
            background: #f0f7ff;
            color: #1a1a1a;
        }

        .sidebar-nav a.active {
            background: #e3f5ff;
            color: #0984e3;
            font-weight: 700;
        }

        /* å³ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            margin-left: 220px;
            flex: 1;
            padding: 40px 48px;
            background: #f7f9fa;
        }

        /* ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .page-header {
            margin-bottom: 28px;
        }

        .page-title {
            font-size: 22px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
            letter-spacing: 0.02em;
            line-height: 1.4;
        }

        .page-description {
            font-size: 13px;
            color: #666666;
            line-height: 1.8;
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ã‚«ãƒ¼ãƒ‰UI
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .card {
            background: #ffffff;
            border-radius: 10px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 15px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 24px;
            letter-spacing: 0.02em;
            line-height: 1.5;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           çµ±è¨ˆè¡¨ç¤ºã‚¨ãƒªã‚¢
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #ffffff;
            border-radius: 10px;
            padding: 28px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-label {
            font-size: 13px;
            color: #666666;
            font-weight: 700;
            margin-bottom: 14px;
            letter-spacing: 0.02em;
            line-height: 1.6;
        }

        .stat-value {
            font-size: 38px;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.1;
        }

        .stat-value.large {
            font-size: 52px;
        }

        .stat-unit {
            font-size: 20px;
            color: #666666;
            margin-left: 4px;
            font-weight: 600;
        }

        .stat-sub {
            font-size: 13px;
            color: #666666;
            margin-top: 12px;
            font-weight: 500;
            line-height: 1.6;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ•ã‚©ãƒ¼ãƒ 
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 10px;
            letter-spacing: 0.02em;
            line-height: 1.6;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
            letter-spacing: 0.01em;
            background: #ffffff;
            color: #333333;
            font-weight: 500;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #0984e3;
            box-shadow: 0 0 0 3px rgba(9, 132, 227, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 70px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* æœ‰çµ¦åŒºåˆ†é¸æŠãƒœã‚¿ãƒ³ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰ */
        .leave-type-selector-inline {
            display: flex;
            gap: 12px;
        }

        .leave-type-btn-inline {
            flex: 1;
            background: #f7f9fa;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: #999999;
        }

        .leave-type-btn-inline:hover {
            background: #e8ebed;
            color: #666666;
        }

        .leave-type-btn-inline.active {
            background: #0984e3;
            color: #ffffff;
            font-weight: 700;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            display: inline-block;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.01em;
            text-decoration: none;
            text-align: center;
        }

        .btn-primary {
            background: #0984e3;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #0770c9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(9, 132, 227, 0.3);
        }

        .btn-secondary {
            background: #ffffff;
            color: #333333;
            border: 1px solid #d0d0d0;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: #f7f9fa;
            border-color: #999999;
        }

        .btn-danger {
            background: #d63031;
            color: #ffffff;
        }

        .btn-danger:hover {
            background: #c0272a;
        }

        .btn-success {
            background: #00b894;
            color: #ffffff;
        }

        .btn-success:hover {
            background: #00a07d;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ†ãƒ¼ãƒ–ãƒ«
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table thead {
            background: #f7f9fa;
        }

        .data-table th {
            padding: 16px;
            text-align: left;
            font-weight: 700;
            color: #1a1a1a;
            letter-spacing: 0.02em;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            line-height: 1.6;
        }

        .data-table td {
            padding: 18px 16px;
            border-bottom: 1px solid #f0f0f0;
            color: #333333;
            font-weight: 500;
            line-height: 1.6;
        }

        .data-table tbody tr:hover {
            background: #f7f9fa;
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒãƒƒã‚¸
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.01em;
            color: #ffffff;
        }

        .badge-warning {
            background: #f39c12;
        }

        .badge-danger {
            background: #e74c3c;
        }

        .badge-success {
            background: #00b894;
        }

        .badge-info {
            background: #0984e3;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ã‚¢ãƒ©ãƒ¼ãƒˆ
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .alert {
            padding: 18px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border-left: 4px solid;
            font-size: 14px;
            line-height: 1.8;
            background: #ffffff;
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        .alert-warning {
            border-color: #fdcb6e;
            background: #fff9e6;
            color: #333333;
        }

        .alert-danger {
            border-color: #d63031;
            background: #ffe8e8;
            color: #333333;
        }

        .alert-info {
            border-color: #0984e3;
            background: #e3f5ff;
            color: #333333;
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆç™½èƒŒæ™¯ãƒ»èµ¤æ–‡å­—ï¼‰ */
        .alert-custom-danger {
            padding: 18px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border-left: 4px solid #d63031;
            font-size: 14px;
            line-height: 1.8;
            background: #ffffff;
            color: #d63031;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            letter-spacing: 0.02em;
        }

        .alert-custom-warning {
            padding: 18px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border-left: 4px solid #f39c12;
            font-size: 14px;
            line-height: 1.8;
            background: #ffffff;
            color: #d63031;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            letter-spacing: 0.02em;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå°ï¼‰
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .action-btn {
            padding: 7px 14px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid #d0d0d0;
            background: #ffffff;
            color: #333333;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .action-btn:hover {
            border-color: #0984e3;
            color: #0984e3;
            background: #f0f7ff;
        }

        .action-btn-danger {
            color: #d63031;
        }

        .action-btn-danger:hover {
            border-color: #d63031;
            background: #ffe8e8;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªãƒ»ã‚»ã‚«ãƒ³ãƒ€ãƒªï¼‰ */
        .action-btn-primary {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 6px;
            border: none;
            background: #0984e3;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 700;
            margin-right: 8px;
        }

        .action-btn-primary:hover {
            background: #0770c9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(9, 132, 227, 0.3);
        }

        .action-btn-secondary {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid #d0d0d0;
            background: #ffffff;
            color: #333333;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .action-btn-secondary:hover {
            background: #f7f9fa;
            border-color: #999999;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ç©ºçŠ¶æ…‹
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #bbb;
        }

        .empty-state-text {
            font-size: 14px;
            color: #999;
            font-weight: 500;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .text-muted {
            color: #666666;
        }

        .text-danger {
            color: #d63031;
            font-weight: 600;
        }

        .text-warning {
            color: #fdcb6e;
            font-weight: 600;
        }

        .mb-0 { margin-bottom: 0; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }

        .hidden {
            display: none;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ¢ãƒ¼ãƒ€ãƒ«
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 10px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 24px;
            letter-spacing: 0.01em;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–
           â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
                border-right: none;
                box-shadow: none;
            }

            .main-content {
                margin-left: 0;
                padding: 24px 20px;
            }

            .app-container {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 24px 20px;
            }
        }
    </style>
</head>
<body>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="login-screen" style="display:flex; align-items:center; justify-content:center; min-height:100vh; background:#f7f9fa;">
        <div style="background:#fff; padding:48px; border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.08); width:100%; max-width:400px;">
            <div style="text-align:center; margin-bottom:32px;">
                <div style="font-size:24px; font-weight:700; color:#1a1a1a;">æœ‰çµ¦ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
                <div style="font-size:14px; color:#888; margin-top:8px;">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</div>
            </div>
            <div style="margin-bottom:16px;">
                <label style="font-size:13px; font-weight:600; color:#555; display:block; margin-bottom:6px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="login-email" class="form-input" placeholder="admin@example.com" style="width:100%;">
            </div>
            <div style="margin-bottom:24px;">
                <label style="font-size:13px; font-weight:600; color:#555; display:block; margin-bottom:6px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="login-password" class="form-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" style="width:100%;" onkeydown="if(event.key==='Enter')login()">
            </div>
            <div id="login-error" style="color:#d63031; font-size:13px; margin-bottom:12px; text-align:center;"></div>
            <button class="btn btn-primary" onclick="login()" style="width:100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div id="loading-overlay" style="display:none; position:fixed; inset:0; background:rgba(255,255,255,0.8); align-items:center; justify-content:center; z-index:9999; font-size:16px; color:#555;">
        èª­ã¿è¾¼ã¿ä¸­...
    </div>

    <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
    <div id="app-screen" style="display:none; width:100%; min-height:100vh;">
    <div class="app-container">
        <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
             å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼
             â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">æœ‰çµ¦ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
                <div class="sidebar-subtitle" id="current-user-email" style="font-size:11px; word-break:break-all;"></div>
            </div>
            <nav style="flex:1;">
                <ul class="sidebar-nav">
                    <li><a href="javascript:void(0);" class="active" data-page="dashboard">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
                    <li><a href="javascript:void(0);" data-page="employees">å¾“æ¥­å“¡ä¸€è¦§</a></li>
                    <li><a href="javascript:void(0);" data-page="register">æœ‰çµ¦ã‚’ç™»éŒ²</a></li>
                    <li><a href="javascript:void(0);" data-page="history">æ¶ˆåŒ–å±¥æ­´</a></li>
                    <li><a href="javascript:void(0);" data-page="expiring">å¤±åŠ¹ç®¡ç†</a></li>
                    <li><a href="javascript:void(0);" data-page="settings">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a></li>
                </ul>
            </nav>
            <div style="padding:16px; border-top:1px solid #e8e8e8; margin-top:auto;">
                <button class="btn btn-secondary" onclick="logout()" style="width:100%; font-size:13px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </aside>

        <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
             å³ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
             â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
        <main class="main-content">
            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-dashboard" class="page">
                <div class="page-header">
                    <h1 class="page-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                    <p class="page-description">å¾“æ¥­å“¡ã®æœ‰çµ¦ä¼‘æš‡çŠ¶æ³ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã¾ã™</p>
                </div>

                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚¢ãƒ©ãƒ¼ãƒˆ -->
                <div id="dashboard-alerts"></div>

                <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
                <div class="stats-grid" id="dashboard-stats">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>

                <!-- å¹´5æ—¥å–å¾—ç¾©å‹™ã‚¢ãƒ©ãƒ¼ãƒˆ -->
                <div class="card" id="five-days-alert-table" style="display: none;">
                    <h2 class="card-title">âš ï¸ å¹´5æ—¥å–å¾—ç¾©å‹™ã‚¢ãƒ©ãƒ¼ãƒˆ</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>æœ€çµ‚ä»˜ä¸æ—¥</th>
                                <th>å–å¾—æ—¥æ•°</th>
                                <th>å¿…è¦æ—¥æ•°</th>
                                <th>æœŸé™ã¾ã§</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="five-days-alert-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <!-- å¤±åŠ¹ã‚¢ãƒ©ãƒ¼ãƒˆ -->
                <div class="card" id="expiring-alert-table" style="display: none;">
                    <h2 class="card-title">âš ï¸ å¤±åŠ¹ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆ30æ—¥ä»¥å†…ï¼‰</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>å¤±åŠ¹æ—¥</th>
                                <th>å¤±åŠ¹äºˆå®šæ—¥æ•°</th>
                                <th>ã‚ã¨ä½•æ—¥</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="expiring-alert-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <!-- ç›´è¿‘ã®æ¶ˆåŒ–å±¥æ­´ -->
                <div class="card">
                    <h2 class="card-title">ç›´è¿‘ã®æ¶ˆåŒ–å±¥æ­´</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥ä»˜</th>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>åŒºåˆ†</th>
                                <th>æ¶ˆåŒ–æ—¥æ•°</th>
                                <th>ãƒ¡ãƒ¢</th>
                            </tr>
                        </thead>
                        <tbody id="recent-history-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 æœ‰çµ¦ã‚’ç™»éŒ²
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-register" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">æœ‰çµ¦ã‚’ç™»éŒ²</h1>
                    <p class="page-description">å¾“æ¥­å“¡ã®æœ‰çµ¦ä¼‘æš‡æ¶ˆåŒ–ã‚’ç™»éŒ²ã—ã¾ã™</p>
                </div>

                <div class="card">
                    <h2 class="card-title">æ–°è¦ç™»éŒ²</h2>
                    <form id="register-form">
                        <div class="form-group">
                            <label class="form-label">å¾“æ¥­å“¡ *</label>
                            <select class="form-select" id="employee-select" required>
                                <option value="">å¾“æ¥­å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">æ—¥ä»˜ *</label>
                                <input type="date" class="form-input" id="leave-date" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">åŒºåˆ† *</label>
                                <div class="leave-type-selector-inline">
                                    <button type="button" class="leave-type-btn-inline active" data-value="1.0" onclick="selectLeaveType(this)">
                                        å…¨ä¼‘ï¼ˆ1.0æ—¥ï¼‰
                                    </button>
                                    <button type="button" class="leave-type-btn-inline" data-value="0.5" onclick="selectLeaveType(this)">
                                        åŠä¼‘ï¼ˆ0.5æ—¥ï¼‰
                                    </button>
                                </div>
                                <input type="hidden" id="leave-type-value" value="1.0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
                            <textarea class="form-textarea" id="leave-memo" placeholder="ç†ç”±ã‚„ãƒ¡ãƒ¢ã‚’å…¥åŠ›" rows="3"></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ç™»éŒ²ã™ã‚‹</button>
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('register-form').reset(); resetLeaveTypeButtons();">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </form>
                </div>

                <!-- æœ€è¿‘ã®ç™»éŒ²å±¥æ­´ -->
                <div class="card">
                    <h2 class="card-title">æœ€è¿‘ã®ç™»éŒ²å±¥æ­´</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>æ—¥ä»˜</th>
                                <th>åŒºåˆ†</th>
                                <th>æ¶ˆåŒ–æ—¥æ•°</th>
                                <th>ãƒ¡ãƒ¢</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="register-history-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 å¾“æ¥­å“¡ä¸€è¦§
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-employees" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">å¾“æ¥­å“¡ä¸€è¦§</h1>
                    <p class="page-description">å¾“æ¥­å“¡ã®æœ‰çµ¦ä¼‘æš‡çŠ¶æ³ã‚’ç¢ºèªãƒ»ç®¡ç†ã§ãã¾ã™</p>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <h2 class="card-title" style="margin-bottom: 0;" id="employee-list-title">å…¨å¾“æ¥­å“¡ï¼ˆ0åï¼‰</h2>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #666; font-weight: 500; cursor: pointer;">
                                <input type="checkbox" id="show-retired" onchange="toggleRetiredEmployees()" style="cursor: pointer;">
                                é€€ç¤¾æ¸ˆã¿ã‚’è¡¨ç¤º
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ å¾“æ¥­å“¡ã‚’è¿½åŠ </button>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>å…¥ç¤¾æ—¥</th>
                                <th>å‹¤ç¶šå¹´æ•°</th>
                                <th>æ®‹æ—¥æ•°</th>
                                <th>æ¬¡ã®ä»˜ä¸æ—¥</th>
                                <th>æ¬¡ã®å¤±åŠ¹æ—¥</th>
                                <th>å¤±åŠ¹äºˆå®š</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="employee-list">
                            <!-- å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                        </tbody>
                    </table>
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼š</strong> ã€Œè©³ç´°ã€ãƒœã‚¿ãƒ³ã‹ã‚‰å„å¾“æ¥­å“¡ã®æ¶ˆåŒ–å±¥æ­´ã‚„æœŸé™åˆ¥æ®‹æ•°ã‚’ç¢ºèªã§ãã¾ã™ã€‚
                </div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 å¾“æ¥­å“¡è©³ç´°
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-employee-detail" class="page hidden">
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h1 class="page-title" id="employee-detail-name"></h1>
                            <p class="page-description">å¾“æ¥­å“¡ã®è©³ç´°æƒ…å ±ã¨æœ‰çµ¦ç®¡ç†</p>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-success" onclick="exportEmployeeCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                            <button class="btn btn-secondary" onclick="showPage('employees')">â† ä¸€è¦§ã«æˆ»ã‚‹</button>
                        </div>
                    </div>
                </div>
                <!-- å‹•çš„ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒŠ -->
                <div id="employee-detail-body"></div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 æ¶ˆåŒ–å±¥æ­´
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-history" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">æ¶ˆåŒ–å±¥æ­´</h1>
                    <p class="page-description">å…¨å¾“æ¥­å“¡ã®æœ‰çµ¦æ¶ˆåŒ–å±¥æ­´ã‚’ç¢ºèªã§ãã¾ã™</p>
                </div>

                <div class="card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥æ™‚</th>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>ç¨®é¡</th>
                                <th>å†…å®¹</th>
                                <th>å¤‰å‹•</th>
                                <th>ç†ç”±</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info">
                    <strong>å±¥æ­´ã«ã¤ã„ã¦ï¼š</strong> ã™ã¹ã¦ã®æ¶ˆåŒ–ãƒ»ä»˜ä¸ãƒ»èª¿æ•´ãƒ»ä¿®æ­£ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚ã€Œãªãœæ¸›ã£ãŸã‹ã€ã‚’ç†ç”±æ¬„ã§ç¢ºèªã§ãã¾ã™ã€‚
                </div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 å¤±åŠ¹ç®¡ç†
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-expiring" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">å¤±åŠ¹ç®¡ç†</h1>
                    <p class="page-description">æœŸé™ãŒè¿‘ã¥ã„ã¦ã„ã‚‹æœ‰çµ¦ã‚’å¾“æ¥­å“¡ã”ã¨ã«ç¢ºèªã§ãã¾ã™</p>
                </div>

                <div id="expiring-alert" style="display: none;">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>

                <div class="card">
                    <h2 class="card-title">å¤±åŠ¹äºˆå®šä¸€è¦§ï¼ˆå¾“æ¥­å“¡åˆ¥ï¼‰</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¾“æ¥­å“¡å</th>
                                <th>å¤±åŠ¹æ—¥</th>
                                <th>å¤±åŠ¹äºˆå®šæ—¥æ•°</th>
                                <th>å…ƒã®ä»˜ä¸æ—¥</th>
                                <th>ã‚ã¨ä½•æ—¥</th>
                                <th>çŠ¶æ…‹</th>
                            </tr>
                        </thead>
                        <tbody id="expiring-body">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info">
                    <strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong> æœ‰çµ¦ã¯ä»˜ä¸æ—¥ã‹ã‚‰2å¹´å¾Œã®å‰æ—¥ã§å¤±åŠ¹ã—ã¾ã™ã€‚æœŸé™ãŒè¿‘ã„ä»˜ä¸æ ã‹ã‚‰å„ªå…ˆçš„ã«æ¶ˆåŒ–ã•ã‚Œã¾ã™ã€‚å¾“æ¥­å“¡ã«æ—©ã‚ã®æ¶ˆåŒ–ã‚’ä¿ƒã™ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
                </div>
            </div>

            <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                 ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
                 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
            <div id="page-settings" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h1>
                    <p class="page-description">æœ‰çµ¦ä»˜ä¸ãƒ«ãƒ¼ãƒ«ã‚„ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®šã‚’ç®¡ç†ã—ã¾ã™</p>
                </div>

                <div class="card">
                    <h2 class="card-title">æœ‰çµ¦ä»˜ä¸ãƒ«ãƒ¼ãƒ«</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å‹¤ç¶šå¹´æ•°</th>
                                <th>ä»˜ä¸æ—¥æ•°</th>
                                <th>å‚™è€ƒ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>0.5å¹´</td><td>10æ—¥</td><td>å…¥ç¤¾6ãƒ¶æœˆå¾Œ</td></tr>
                            <tr><td>1.5å¹´</td><td>11æ—¥</td><td>-</td></tr>
                            <tr><td>2.5å¹´</td><td>12æ—¥</td><td>-</td></tr>
                            <tr><td>3.5å¹´</td><td>14æ—¥</td><td>-</td></tr>
                            <tr><td>4.5å¹´</td><td>16æ—¥</td><td>-</td></tr>
                            <tr><td>5.5å¹´</td><td>18æ—¥</td><td>-</td></tr>
                            <tr><td>6.5å¹´ä»¥ä¸Š</td><td>20æ—¥</td><td>æœ€å¤§ä»˜ä¸æ—¥æ•°</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2 class="card-title">æœ‰çµ¦ç®¡ç†ãƒ«ãƒ¼ãƒ«</h2>
                    <div style="line-height: 2; color: #555;">
                        <p><strong>æ¶ˆåŒ–å˜ä½ï¼š</strong> å…¨ä¼‘ï¼ˆ1.0æ—¥ï¼‰ã€åŠä¼‘ï¼ˆ0.5æ—¥ï¼‰</p>
                        <p><strong>æ¶ˆåŒ–é †åºï¼š</strong> æœŸé™ãŒè¿‘ã„ä»˜ä¸æ ã‹ã‚‰å„ªå…ˆï¼ˆFIFOï¼‰</p>
                        <p><strong>å¤±åŠ¹æ—¥ï¼š</strong> ä»˜ä¸æ—¥ã‹ã‚‰2å¹´å¾Œã®å‰æ—¥</p>
                        <p><strong>ä¿æœ‰ä¸Šé™ï¼š</strong> 40æ—¥</p>
                        <p><strong>ç¹°è¶Šå¯èƒ½æ—¥æ•°ï¼š</strong> 20æ—¥</p>
                        <p><strong>ä¸Šé™è¶…éæ™‚ï¼š</strong> æœŸé™ãŒè¿‘ã„ä»˜ä¸æ ã‹ã‚‰è‡ªå‹•æ¸›ç®—</p>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    
                    <div style="margin-bottom: 32px;">
                        <h3 style="font-size: 15px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                        <p style="font-size: 13px; color: #888; margin-bottom: 16px;">
                            å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿ã¨æœ‰çµ¦æ¶ˆåŒ–å±¥æ­´ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¸€æ‹¬å–ã‚Šè¾¼ã¿ã§ãã¾ã™ã€‚<br>
                            å…¥ç¤¾æ—¥ã‹ã‚‰è‡ªå‹•çš„ã«æœ‰çµ¦ã®ä»˜ä¸ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
                        </p>
                        
                        <div style="margin-bottom: 16px;">
                            <label class="form-label">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
                            <input type="file" id="csv-file-input" accept=".csv" class="form-input">
                        </div>
                        
                        <div class="btn-group" style="margin-top: 0;">
                            <button class="btn btn-primary" onclick="importCSV()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
                            <button class="btn btn-secondary" onclick="downloadSampleCSV()">ã‚µãƒ³ãƒ—ãƒ«CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                        
                        <div id="import-result" style="margin-top: 16px;"></div>
                    </div>
                    
                    <div style="border-top: 1px solid #e8e8e8; padding-top: 24px;">
                        <h3 style="font-size: 15px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
                        <p style="font-size: 13px; color: #888; margin-bottom: 12px;">CSVãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                        <div style="background: #f7f9fa; padding: 16px; border-radius: 6px; font-family: monospace; font-size: 12px; overflow-x: auto;">
                            æ°å,å…¥ç¤¾æ—¥,æ¶ˆåŒ–æ—¥<br>
                            å±±ç”° å¤ªéƒ,2022-04-01,2025-02-10<br>
                            ä½è—¤ èŠ±å­,2019-04-01,2025-01-15<br>
                            éˆ´æœ¨ ä¸€éƒ,2020-10-01,2025-02-08
                        </div>
                        <ul style="font-size: 13px; color: #666; margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                            <li>1è¡Œç›®ã¯å¿…ãšãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆæ°å,å…¥ç¤¾æ—¥,æ¶ˆåŒ–æ—¥ï¼‰</li>
                            <li>æ—¥ä»˜ã¯ã€ŒYYYY-MM-DDã€å½¢å¼ï¼ˆä¾‹: 2022-04-01ï¼‰</li>
                            <li>åŒã˜å¾“æ¥­å“¡ã®æ¶ˆåŒ–æ—¥ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ã€è¡Œã‚’åˆ†ã‘ã¦è¨˜è¼‰</li>
                            <li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8ã§ä¿å­˜ã—ã¦ãã ã•ã„</li>
                        </ul>
                    </div>
                    
                    <div style="border-top: 1px solid #e8e8e8; padding-top: 24px; margin-top: 24px;">
                        <h3 style="font-size: 15px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
                        <div class="btn-group" style="margin-top: 0;">
                            <button class="btn btn-success" onclick="exportCSV()">ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                            <button class="btn btn-secondary" onclick="backupData()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆJSONï¼‰</button>
                        </div>
                    </div>

                    <div style="border-top: 1px solid #e8e8e8; padding-top: 24px; margin-top: 24px;">
                        <h3 style="font-size: 15px; font-weight: 600; color: #d63031; margin-bottom: 8px;">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</h3>
                        <p style="font-size: 13px; color: #888; margin-bottom: 16px;">
                            å…¨ã¦ã®å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿ã¨æœ‰çµ¦å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
                        </p>
                        <button class="btn btn-danger" onclick="resetAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>ğŸ’¡ ç®¡ç†è€…æ©Ÿèƒ½ï¼š</strong> ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯æœ‰çµ¦ã®ä»˜ä¸ãƒ«ãƒ¼ãƒ«ã‚„ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’ç¢ºèªã§ãã¾ã™ã€‚ãƒ«ãƒ¼ãƒ«ã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
                </div>
            </div>
        </main>
    </div>

    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
         å¾“æ¥­å“¡è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
         â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <div id="add-employee-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">å¾“æ¥­å“¡ã‚’è¿½åŠ </div>
            <form id="add-employee-form">
                <div class="form-group">
                    <label class="form-label">æ°å *</label>
                    <input type="text" class="form-input" id="add-employee-name" required placeholder="ä¾‹: å±±ç”° å¤ªéƒ">
                </div>
                <div class="form-group">
                    <label class="form-label">ãƒ•ãƒªã‚¬ãƒŠ *</label>
                    <input type="text" class="form-input" id="add-employee-kana" required placeholder="ä¾‹: ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦">
                </div>
                <div class="form-group">
                    <label class="form-label">å…¥ç¤¾æ—¥ *</label>
                    <input type="date" class="form-input" id="add-employee-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆæœŸä»˜ä¸æ—¥æ•°</label>
                    <input type="number" class="form-input" id="add-employee-initial-days" value="10" step="0.5" min="0">
                    <p style="font-size: 12px; color: #888; margin-top: 6px;">â€» å…¥ç¤¾6ãƒ¶æœˆå¾Œã®ä»˜ä¸æ—¥æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-employee-modal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">è¿½åŠ ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>

    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
         å¾“æ¥­å“¡ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
         â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <div id="edit-employee-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">å¾“æ¥­å“¡æƒ…å ±ã‚’ç·¨é›†</div>
            <form id="edit-employee-form">
                <div class="form-group">
                    <label class="form-label">æ°å *</label>
                    <input type="text" class="form-input" id="edit-employee-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ãƒ•ãƒªã‚¬ãƒŠ *</label>
                    <input type="text" class="form-input" id="edit-employee-kana" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å…¥ç¤¾æ—¥ *</label>
                    <input type="date" class="form-input" id="edit-employee-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">åœ¨ç±çŠ¶æ³ *</label>
                    <select class="form-select" id="edit-employee-status">
                        <option value="active">åœ¨ç±ä¸­</option>
                        <option value="retired">é€€ç¤¾æ¸ˆã¿</option>
                    </select>
                    <p style="font-size: 12px; color: #666; margin-top: 6px; line-height: 1.6;">â€» é€€ç¤¾æ¸ˆã¿ã«ã™ã‚‹ã¨å¾“æ¥­å“¡ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ãŒã€å±¥æ­´ã¯ä¿æŒã•ã‚Œã¾ã™</p>
                </div>
                <div class="form-group">
                    <label class="form-label">é€€ç¤¾æ—¥</label>
                    <input type="date" class="form-input" id="edit-employee-retirement-date">
                    <p style="font-size: 12px; color: #666; margin-top: 6px; line-height: 1.6;">â€» é€€ç¤¾æ¸ˆã¿ã®å ´åˆã®ã¿å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                </div>
                <div class="form-group">
                    <label class="form-label">ãƒ¡ãƒ¢</label>
                    <textarea class="form-textarea" id="edit-employee-memo" placeholder="å‚™è€ƒã‚„ãƒ¡ãƒ¢ã‚’å…¥åŠ›" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="deleteEmployee()">å‰Šé™¤</button>
                    <div style="flex: 1;"></div>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-employee-modal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æœ‰çµ¦ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="edit-record-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æœ‰çµ¦ç™»éŒ²ã®ä¿®æ­£</h3>
                <button class="modal-close" onclick="closeModal('edit-record-modal')">Ã—</button>
            </div>
            <form id="edit-record-form">
                <div class="form-group">
                    <label class="form-label">å¾“æ¥­å“¡</label>
                    <input type="text" class="form-input" id="edit-record-employee-name" readonly style="background: #f5f6fa; color: #666;">
                </div>
                <div class="form-group">
                    <label class="form-label">æ—¥ä»˜ *</label>
                    <input type="date" class="form-input" id="edit-record-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">åŒºåˆ† *</label>
                    <div style="display: flex; gap: 10px; margin-top: 8px;">
                        <button type="button" class="leave-type-btn-inline active" data-value="1.0" onclick="selectEditRecordType(this)">å…¨ä¼‘ï¼ˆ1æ—¥ï¼‰</button>
                        <button type="button" class="leave-type-btn-inline" data-value="0.5" onclick="selectEditRecordType(this)">åŠä¼‘ï¼ˆ0.5æ—¥ï¼‰</button>
                    </div>
                    <input type="hidden" id="edit-record-type-value" value="1.0">
                </div>
                <div class="form-group">
                    <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
                    <textarea class="form-textarea" id="edit-record-memo" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteRecord()">å–æ¶ˆï¼ˆå‰Šé™¤ï¼‰</button>
                    <div style="flex: 1;"></div>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-record-modal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // æœ‰çµ¦ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - Supabaseç‰ˆ
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        var SUPABASE_URL = 'https://esxadkckccnxxkppntik.supabase.co';
        var SUPABASE_KEY = 'sb_publishable_wTgelyDZenudXfAnXqwecA_VEu5LYNB';
        var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        var employeesData = [];
        var leaveRecords = [];
        var currentEmployeeId = null;
        var currentUser = null;

        // â”â”â” åˆæœŸåŒ– â”â”â”
        function initSystem() {
            supabase.auth.getSession().then(function(result) {
                var session = result.data.session;
                if (session) {
                    currentUser = session.user;
                    showApp();
                } else {
                    showLoginScreen();
                }
            });
            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ç›£è¦–
            supabase.auth.onAuthStateChange(function(event, session) {
                if (event === 'SIGNED_IN') {
                    currentUser = session.user;
                    showApp();
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    showLoginScreen();
                }
            });
        }

        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app-screen').style.display = 'none';
        }

        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('current-user-email').textContent = currentUser.email;
            loadData();
        }

        function login() {
            var email = document.getElementById('login-email').value;
            var password = document.getElementById('login-password').value;
            var errorEl = document.getElementById('login-error');
            errorEl.textContent = '';

            supabase.auth.signInWithPassword({ email: email, password: password })
                .then(function(result) {
                    if (result.error) {
                        errorEl.textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™';
                    }
                });
        }

        function logout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                supabase.auth.signOut();
            }
        }

        // â”â”â” ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ â”â”â”
        function loadData() {
            showLoading(true);
            Promise.all([
                supabase.from('employees').select('*').order('kana'),
                supabase.from('leave_records').select('*').order('date')
            ]).then(function(results) {
                var empsResult = results[0];
                var recsResult = results[1];

                if (empsResult.error) { console.error(empsResult.error); }
                if (recsResult.error) { console.error(recsResult.error); }

                // Supabaseã®ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã‚’ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
                employeesData = (empsResult.data || []).map(function(e) {
                    return {
                        id: e.id,
                        name: e.name || '',
                        kana: e.kana || '',
                        hireDate: e.hire_date || '',
                        status: e.status || 'active',
                        retirementDate: e.retirement_date || null,
                        memo: e.memo || ''
                    };
                });

                leaveRecords = (recsResult.data || []).map(function(r) {
                    return {
                        id: r.id,
                        employeeId: parseInt(r.employee_id),
                        date: r.date || '',
                        type: parseFloat(r.type) || 1.0,
                        memo: r.memo || '',
                        createdAt: r.created_at || ''
                    };
                });

                showLoading(false);
                renderDashboard();
                renderEmployeeList();
                renderEmployeeSelect();
                renderRegisterHistory();
                renderHistory();
                renderExpiring();
                setupEventListeners();
            });
        }

        function showLoading(flag) {
            var el = document.getElementById('loading-overlay');
            if (el) el.style.display = flag ? 'flex' : 'none';
        }

        // â”â”â” ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆSupabaseï¼‰ â”â”â”
        function saveEmployees() { /* Supabaseã§ã¯å€‹åˆ¥æ“ä½œã§ä¿å­˜ */ }
        function saveRecords()   { /* Supabaseã§ã¯å€‹åˆ¥æ“ä½œã§ä¿å­˜ */ }

        function getNextEmployeeId() { return null; } // SupabaseãŒè‡ªå‹•æ¡ç•ª
        function getNextRecordId()   { return null; } // SupabaseãŒè‡ªå‹•æ¡ç•ª

        function getEmployeeById(id) {
            return employeesData.find(function(emp) { return emp.id === parseInt(id); });
        }

        function getRecordsByEmployeeId(employeeId) {
            var id = parseInt(employeeId);
            return leaveRecords.filter(function(rec) { return parseInt(rec.employeeId) === id; });
        }

        function getNextEmployeeId() {
            var counter = parseInt(localStorage.getItem(STORAGE_KEY_EMP_COUNTER) || '0') + 1;
            localStorage.setItem(STORAGE_KEY_EMP_COUNTER, counter);
            return counter;
        }

        function getNextRecordId() {
            var counter = parseInt(localStorage.getItem(STORAGE_KEY_REC_COUNTER) || '0') + 1;
            localStorage.setItem(STORAGE_KEY_REC_COUNTER, counter);
            return counter;
        }

        function formatDate(dateStr) {
            // 'YYYY-MM-DD' ã‚’ç›´æ¥ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚ºãƒ¬ã‚’é˜²ã
            var parts = dateStr.split('-');
            var y = parts[0];
            var m = parts[1];
            var d = parts[2];
            return y + '/' + m + '/' + d;
        }

        function parseLocalDate(dateStr) {
            // 'YYYY-MM-DD' ã‚’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã¨ã—ã¦è§£é‡ˆã—ã¦Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™
            var parts = dateStr.split('-');
            return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        }

        function calculateYearsOfService(hireDate) {
            var hire = parseLocalDate(hireDate);
            var today = new Date();
            var diffTime = today - hire;
            return diffTime / (1000 * 60 * 60 * 24 * 365.25);
        }

        function getLeaveDaysByYears(years) {
            if (years < 0.5) return 0;
            if (years < 1.5) return 10;
            if (years < 2.5) return 11;
            if (years < 3.5) return 12;
            if (years < 4.5) return 14;
            if (years < 5.5) return 16;
            if (years < 6.5) return 18;
            return 20;
        }

        function generateLeaveGrants(hireDate) {
            var grants = [];
            var hire = parseLocalDate(hireDate);
            var today = new Date();
            var grantDate = parseLocalDate(hireDate);
            grantDate.setMonth(grantDate.getMonth() + 6);

            var years = 0.5;
            while (grantDate <= today) {
                var days = getLeaveDaysByYears(years);
                var expiryDate = new Date(grantDate.getFullYear(), grantDate.getMonth(), grantDate.getDate());
                expiryDate.setFullYear(expiryDate.getFullYear() + 2);
                expiryDate.setDate(expiryDate.getDate() - 1);

                var grantStr = grantDate.getFullYear() + '-' +
                    ('0' + (grantDate.getMonth() + 1)).slice(-2) + '-' +
                    ('0' + grantDate.getDate()).slice(-2);
                var expiryStr = expiryDate.getFullYear() + '-' +
                    ('0' + (expiryDate.getMonth() + 1)).slice(-2) + '-' +
                    ('0' + expiryDate.getDate()).slice(-2);

                grants.push({
                    grantDate: grantStr,
                    expiryDate: expiryStr,
                    days: days,
                    years: years
                });

                grantDate = new Date(grantDate.getFullYear(), grantDate.getMonth(), grantDate.getDate());
                grantDate.setFullYear(grantDate.getFullYear() + 1);
                years += 1;
            }

            return grants;
        }

        function calculateRemainingDays(employeeId) {
            var emp = getEmployeeById(employeeId);
            if (!emp) return { remaining: 0, advance: 0, nextGrantDays: 0 };

            var grants = generateLeaveGrants(emp.hireDate);
            var today = new Date();
            var todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());

            // æ¬¡å›ä»˜ä¸äºˆå®šã‚’è¨ˆç®—
            var nextGrantDays = 0;
            if (grants.length === 0) {
                nextGrantDays = getLeaveDaysByYears(0.5);
            } else {
                var years = grants.length + 0.5;
                nextGrantDays = getLeaveDaysByYears(years);
            }

            // ãƒ‡ãƒãƒƒã‚°ç”¨
            var debugMode = emp.name && emp.name.indexOf('å±±ç”°') !== -1;
            if (debugMode) console.log('=== ' + emp.name + 'ã•ã‚“ã®æ®‹æ—¥æ•°è¨ˆç®— ===');

            // ä»˜ä¸æ ã”ã¨ã«æ®‹æ—¥æ•°ã‚’ç®¡ç†
            var buckets = grants.map(function(g, idx) {
                var gd = parseLocalDate(g.grantDate);
                var ed = parseLocalDate(g.expiryDate);
                // æ—¥ä»˜ã®ã¿ã§æ¯”è¼ƒã™ã‚‹ãŸã‚æ™‚åˆ»ã‚’æ­£è¦åŒ–
                gd.setHours(0, 0, 0, 0);
                ed.setHours(23, 59, 59, 999);
                if (debugMode) console.log((idx+1) + 'å›ç›®ä»˜ä¸: ' + g.grantDate + ' ~ ' + g.expiryDate + ' (' + g.days + 'æ—¥)');
                return {
                    grantDate:  gd,
                    expiryDate: ed,
                    days: g.days,
                    used: 0  // ã“ã®ä»˜ä¸ã‹ã‚‰ä½¿ã£ãŸæ—¥æ•°
                };
            });

            // æ¶ˆåŒ–å±¥æ­´ã‚’æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
            var records = getRecordsByEmployeeId(employeeId);
            var sortedRecords = records.slice().sort(function(a, b) {
                return parseLocalDate(a.date) - parseLocalDate(b.date);
            });
            if (debugMode) console.log('\næ¶ˆåŒ–å±¥æ­´: ' + sortedRecords.length + 'ä»¶');
            
            // æ¶ˆåŒ–ã‚’å¤ã„ä»˜ä¸ã‹ã‚‰é †ç•ªã«å¼•ãï¼ˆFIFOï¼‰
            sortedRecords.forEach(function(rec) {
                var used = parseFloat(rec.type);
                
                // å¤ã„ä»˜ä¸ã‹ã‚‰é †ã«å¼•ã„ã¦ã„ã
                for (var i = 0; i < buckets.length && used > 0; i++) {
                    if (buckets[i].days - buckets[i].used > 0) {
                        var take = Math.min(buckets[i].days - buckets[i].used, used);
                        buckets[i].used += take;
                        used -= take;
                    }
                }
            });

            // æœ‰åŠ¹ãªä»˜ä¸ã®æ®‹æ—¥æ•°ã‚’åˆè¨ˆ
            todayDate.setHours(0, 0, 0, 0);
            var validRemaining = 0;
            if (debugMode) console.log('\nå„ä»˜ä¸ã®ä½¿ç”¨çŠ¶æ³:');
            buckets.forEach(function(b, idx) {
                var gd = new Date(b.grantDate);
                gd.setHours(0, 0, 0, 0);
                var isGranted = gd <= todayDate;
                var isValid = b.expiryDate >= todayDate;
                var remaining = b.days - b.used;
                
                if (debugMode) {
                    console.log((idx+1) + 'å›ç›®: ' + b.days + 'æ—¥ - ' + b.used.toFixed(1) + 'æ—¥ = ' + remaining.toFixed(1) + 'æ—¥æ®‹ ' +
                        '(ä»˜ä¸æ¸ˆ:' + (isGranted?'â—‹':'Ã—') + ' æœ‰åŠ¹:' + (isValid?'â—‹':'Ã—') + ')');
                }
                
                // ä»˜ä¸æ—¥ãŒä»Šæ—¥ä»¥å‰ã€ã‹ã¤ä½¿ç”¨æœŸé™ãŒä»Šæ—¥ä»¥é™ã®å ´åˆã®ã¿æœ‰åŠ¹
                if (isGranted && isValid && remaining > 0) {
                    validRemaining += remaining;
                }
            });

            // ä¸Šé™40æ—¥é©ç”¨
            var beforeLimit = validRemaining;
            validRemaining = Math.min(validRemaining, 40);
            
            if (debugMode) {
                console.log('\næœ‰åŠ¹æ®‹æ—¥æ•°: ' + beforeLimit.toFixed(1) + 'æ—¥');
                console.log('ä¸Šé™40æ—¥é©ç”¨å¾Œ: ' + validRemaining.toFixed(1) + 'æ—¥');
            }

            return {
                remaining: validRemaining,
                advance: 0,  // ã“ã®æ–¹å¼ã§ã¯å‰å€Ÿã‚Šè¨ˆç®—ã¯ä¸è¦
                nextGrantDays: nextGrantDays
            };
        }

        function renderEmployeeSelect() {
            var select = document.getElementById('employee-select');
            if (!select) return;

            var activeEmployees = employeesData.filter(function(emp) {
                return emp.status === 'active';
            }).sort(function(a, b) {
                if (a.kana < b.kana) return -1;
                if (a.kana > b.kana) return 1;
                return 0;
            });

            var html = '<option value="">å¾“æ¥­å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            activeEmployees.forEach(function(emp) {
                var result = calculateRemainingDays(emp.id);
                html += '<option value="' + emp.id + '">' + emp.name + 'ï¼ˆæ®‹: ' + result.remaining.toFixed(1) + 'æ—¥ï¼‰</option>';
            });

            select.innerHTML = html;
        }

        function renderDashboard() {
            console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æç”»ä¸­...');
            
            var activeEmployees = employeesData.filter(function(emp) {
                return emp.status === 'active';
            });
            
            var totalEmployees = activeEmployees.length;
            
            // ä»Šæœˆã®æ¶ˆåŒ–ç·æ•°ã‚’è¨ˆç®—
            var today = new Date();
            var thisMonthRecords = leaveRecords.filter(function(rec) {
                var recDate = parseLocalDate(rec.date);
                return recDate.getMonth() === today.getMonth() && 
                       recDate.getFullYear() === today.getFullYear();
            });
            var thisMonthTotal = thisMonthRecords.reduce(function(sum, rec) {
                return sum + rec.type;
            }, 0);
            
            // å¤±åŠ¹äºˆå®šï¼ˆ30æ—¥ä»¥å†…ï¼‰ã‚’è¨ˆç®—
            var expiringData = [];
            var expiringDaysTotal = 0;
            activeEmployees.forEach(function(emp) {
                var grants = generateLeaveGrants(emp.hireDate);
                
                grants.forEach(function(grant) {
                    var expiryDate = parseLocalDate(grant.expiryDate);
                    var daysUntilExpiry = Math.floor((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntilExpiry >= 0 && daysUntilExpiry <= 30) {
                        expiringData.push({
                            employee: emp,
                            expiryDate: grant.expiryDate,
                            days: grant.days,
                            daysUntil: daysUntilExpiry
                        });
                        expiringDaysTotal += grant.days;
                    }
                });
            });
            
            // å¹³å‡æ®‹æ—¥æ•°ã‚’è¨ˆç®—
            var totalRemaining = 0;
            activeEmployees.forEach(function(emp) {
                totalRemaining += calculateRemainingDays(emp.id).remaining;
            });
            var averageRemaining = totalEmployees > 0 ? totalRemaining / totalEmployees : 0;
            
            // ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆ
            var alertsHTML = '';
            if (expiringData.length > 0) {
                alertsHTML += '<div class="alert alert-custom-warning">';
                alertsHTML += '<strong>âš ï¸ å¤±åŠ¹äºˆå®šã®æ³¨æ„ï¼š</strong> ' + expiringData.length + 'ä»¶ã®æœ‰çµ¦ãŒ30æ—¥ä»¥å†…ã«å¤±åŠ¹äºˆå®šã§ã™';
                alertsHTML += '</div>';
            }
            var alertsContainer = document.getElementById('dashboard-alerts');
            if (alertsContainer) {
                alertsContainer.innerHTML = alertsHTML;
            }
            
            // çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            var statsHTML = '';
            statsHTML += '<div class="stat-card">';
            statsHTML += '<div class="stat-label">ç™»éŒ²å¾“æ¥­å“¡æ•°</div>';
            statsHTML += '<div class="stat-value">' + totalEmployees + '<span class="stat-unit">å</span></div>';
            statsHTML += '</div>';
            
            statsHTML += '<div class="stat-card">';
            statsHTML += '<div class="stat-label">ä»Šæœˆã®æ¶ˆåŒ–ç·æ•°</div>';
            statsHTML += '<div class="stat-value">' + thisMonthTotal.toFixed(1) + '<span class="stat-unit">æ—¥</span></div>';
            statsHTML += '</div>';
            
            statsHTML += '<div class="stat-card">';
            statsHTML += '<div class="stat-label">å¤±åŠ¹äºˆå®šï¼ˆ30æ—¥ä»¥å†…ï¼‰</div>';
            var expiringClass = expiringDaysTotal > 0 ? 'text-danger' : '';
            statsHTML += '<div class="stat-value ' + expiringClass + '">' + expiringDaysTotal.toFixed(1) + '<span class="stat-unit">æ—¥</span></div>';
            if (expiringData.length > 0) {
                statsHTML += '<div class="stat-sub text-danger">' + expiringData.length + 'ä»¶</div>';
            }
            statsHTML += '</div>';
            
            statsHTML += '<div class="stat-card">';
            statsHTML += '<div class="stat-label">å¹³å‡æ®‹æ—¥æ•°</div>';
            statsHTML += '<div class="stat-value">' + averageRemaining.toFixed(1) + '<span class="stat-unit">æ—¥</span></div>';
            statsHTML += '</div>';
            
            var statsContainer = document.getElementById('dashboard-stats');
            if (statsContainer) {
                statsContainer.innerHTML = statsHTML;
            }
            
            // å¤±åŠ¹ã‚¢ãƒ©ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
            var expiringTable = document.getElementById('expiring-alert-table');
            if (expiringTable) {
                if (expiringData.length > 0) {
                    expiringTable.style.display = '';
                    var expiringHTML = '';
                    expiringData.forEach(function(item) {
                        expiringHTML += '<tr>';
                        expiringHTML += '<td><strong>' + item.employee.name + '</strong></td>';
                        expiringHTML += '<td class="text-danger">' + formatDate(item.expiryDate) + '</td>';
                        expiringHTML += '<td class="text-danger"><strong>' + item.days.toFixed(1) + 'æ—¥</strong></td>';
                        expiringHTML += '<td class="text-danger">' + item.daysUntil + 'æ—¥</td>';
                        expiringHTML += '<td><button class="action-btn-primary" onclick="showEmployeeDetail(' + item.employee.id + ')">è©³ç´°</button></td>';
                        expiringHTML += '</tr>';
                    });
                    document.getElementById('expiring-alert-body').innerHTML = expiringHTML;
                } else {
                    expiringTable.style.display = 'none';
                }
            }
            
            // ç›´è¿‘ã®æ¶ˆåŒ–å±¥æ­´ã‚’ç”Ÿæˆ
            var recentRecords = leaveRecords.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 10);
            
            var historyHTML = '';
            if (recentRecords.length === 0) {
                historyHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æ¶ˆåŒ–å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                recentRecords.forEach(function(rec) {
                    var emp = getEmployeeById(rec.employeeId);
                    if (!emp) return;
                    
                    var badge = rec.type === 1.0 ? 
                        '<span class="badge badge-info">å…¨ä¼‘</span>' : 
                        '<span class="badge badge-success">åŠä¼‘</span>';
                    
                    historyHTML += '<tr>';
                    historyHTML += '<td>' + formatDate(rec.date) + '</td>';
                    historyHTML += '<td>' + emp.name + '</td>';
                    historyHTML += '<td>' + badge + '</td>';
                    historyHTML += '<td>' + rec.type.toFixed(1) + 'æ—¥</td>';
                    historyHTML += '<td>' + (rec.memo || '-') + '</td>';
                    historyHTML += '</tr>';
                });
            }
            var historyBody = document.getElementById('recent-history-body');
            if (historyBody) {
                historyBody.innerHTML = historyHTML;
            }
            
            // â”â”â” å¹´5æ—¥å–å¾—ç¾©å‹™ãƒã‚§ãƒƒã‚¯ â”â”â”
            var todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            var fiveDaysAlert = [];

            activeEmployees.forEach(function(emp) {
                var grants = generateLeaveGrants(emp.hireDate);
                if (grants.length === 0) return;

                // æœ€æ–°ã®ä»˜ä¸æ ã‚’å¯¾è±¡ã«ãƒã‚§ãƒƒã‚¯ï¼ˆä»˜ä¸æ—¥ã€œä»˜ä¸æ—¥+1å¹´ãŒç®¡ç†æœŸé–“ï¼‰
                grants.forEach(function(grant) {
                    var periodStart = parseLocalDate(grant.grantDate);
                    var periodEnd = new Date(periodStart.getFullYear() + 1, periodStart.getMonth(), periodStart.getDate());
                    periodEnd.setDate(periodEnd.getDate() - 1);

                    // ç®¡ç†æœŸé–“ãŒã¾ã çµ‚ã‚ã£ã¦ã„ãªã„ï¼ˆç¾åœ¨é€²è¡Œä¸­ã¾ãŸã¯æœªæ¥ï¼‰
                    if (periodEnd < todayDate) return;
                    // ç®¡ç†æœŸé–“ãŒã¾ã å§‹ã¾ã£ã¦ã„ãªã„
                    if (periodStart > todayDate) return;

                    // ã“ã®ç®¡ç†æœŸé–“å†…ã®æ¶ˆåŒ–æ—¥æ•°ã‚’é›†è¨ˆ
                    var records = getRecordsByEmployeeId(emp.id);
                    var usedInPeriod = records.reduce(function(s, r) {
                        var d = parseLocalDate(r.date);
                        if (d >= periodStart && d <= periodEnd) {
                            return s + parseFloat(r.type);
                        }
                        return s;
                    }, 0);

                    // 5æ—¥æœªæº€ã®å ´åˆã‚¢ãƒ©ãƒ¼ãƒˆ
                    if (usedInPeriod < 5) {
                        var daysLeft = Math.floor((periodEnd - todayDate) / (1000 * 60 * 60 * 24));
                        fiveDaysAlert.push({
                            employee: emp,
                            periodStart: grant.grantDate,
                            periodEnd: periodEnd.getFullYear() + '-' + ('0'+(periodEnd.getMonth()+1)).slice(-2) + '-' + ('0'+periodEnd.getDate()).slice(-2),
                            used: usedInPeriod,
                            shortage: 5 - usedInPeriod,
                            daysLeft: daysLeft
                        });
                    }
                });
            });

            // å¹´5æ—¥ç¾©å‹™ã‚¢ãƒ©ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
            var fiveDaysTable = document.getElementById('five-days-alert-table');
            if (fiveDaysTable) {
                if (fiveDaysAlert.length > 0) {
                    fiveDaysTable.style.display = '';
                    var fiveDaysHTML = '';
                    fiveDaysAlert.forEach(function(item) {
                        var urgentClass = item.daysLeft <= 30 ? 'text-danger' : (item.daysLeft <= 90 ? 'text-warning' : '');
                        fiveDaysHTML += '<tr>';
                        fiveDaysHTML += '<td><strong>' + item.employee.name + '</strong></td>';
                        fiveDaysHTML += '<td>' + formatDate(item.periodStart) + ' ã€œ ' + formatDate(item.periodEnd) + '</td>';
                        fiveDaysHTML += '<td>' + item.used.toFixed(1) + 'æ—¥</td>';
                        fiveDaysHTML += '<td class="text-danger"><strong>ã‚ã¨ ' + item.shortage.toFixed(1) + 'æ—¥å¿…è¦</strong></td>';
                        fiveDaysHTML += '<td class="' + urgentClass + '">' + item.daysLeft + 'æ—¥</td>';
                        fiveDaysHTML += '<td><button class="action-btn-primary" onclick="showEmployeeDetail(' + item.employee.id + ')">è©³ç´°</button></td>';
                        fiveDaysHTML += '</tr>';
                    });
                    document.getElementById('five-days-alert-body').innerHTML = fiveDaysHTML;
                } else {
                    fiveDaysTable.style.display = 'none';
                }
            }

            console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æç”»å®Œäº†');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(function(page) {
                page.classList.add('hidden');
            });
            document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
                link.classList.remove('active');
            });

            var targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }

            var clickedLink = document.querySelector('[data-page="' + pageId + '"]');
            if (clickedLink) {
                clickedLink.classList.add('active');
            }

            window.scrollTo(0, 0);

            if (pageId === 'employees') {
                renderEmployeeList();
            } else if (pageId === 'register') {
                renderEmployeeSelect();
                renderRegisterHistory();
            } else if (pageId === 'dashboard') {
                renderDashboard();
            } else if (pageId === 'history') {
                renderHistory();
            } else if (pageId === 'expiring') {
                renderExpiring();
            }
        }

        function renderEmployeeList() {
            var tbody = document.getElementById('employee-list');
            if (!tbody) return;

            var sortedEmployees = employeesData.slice().sort(function(a, b) {
                if (a.kana < b.kana) return -1;
                if (a.kana > b.kana) return 1;
                return 0;
            });
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            var activeCount = sortedEmployees.filter(function(emp) {
                return emp.status === 'active';
            }).length;
            var titleElem = document.getElementById('employee-list-title');
            if (titleElem) {
                titleElem.textContent = 'å…¨å¾“æ¥­å“¡ï¼ˆ' + activeCount + 'åï¼‰';
            }

            var html = '';
            if (sortedEmployees.length === 0) {
                html = '<tr><td colspan="8" style="text-align: center; color: #999; padding: 40px;">å¾“æ¥­å“¡ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€Œ+ å¾“æ¥­å“¡ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</td></tr>';
            } else {
                sortedEmployees.forEach(function(emp) {
                var isRetired = emp.status === 'retired';
                var displayStyle = isRetired ? 'style="display: none;"' : '';
                var retiredClass = isRetired ? 'retired-employee' : '';
                var retiredBadge = isRetired ? '<span class="badge badge-warning" style="margin-left: 8px;">é€€ç¤¾æ¸ˆã¿</span>' : '';

                if (emp.status === 'active') {
                    var years = calculateYearsOfService(emp.hireDate);
                    var result = calculateRemainingDays(emp.id);
                    var grants = generateLeaveGrants(emp.hireDate);

                    // æ¬¡ã®ä»˜ä¸æ—¥ï¼šæœ€å¾Œã®ä»˜ä¸æ—¥ã‹ã‚‰1å¹´å¾Œï¼ˆã¾ã ä»˜ä¸ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å…¥ç¤¾6ãƒ¶æœˆå¾Œï¼‰
                    var nextGrantStr = '-';
                    if (grants.length === 0) {
                        // ã¾ã 1å›ã‚‚ä»˜ä¸ã•ã‚Œã¦ã„ãªã„ â†’ å…¥ç¤¾6ãƒ¶æœˆå¾Œ
                        var firstGrant = parseLocalDate(emp.hireDate);
                        firstGrant.setMonth(firstGrant.getMonth() + 6);
                        nextGrantStr = firstGrant.getFullYear() + '-' +
                            ('0' + (firstGrant.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + firstGrant.getDate()).slice(-2);
                    } else {
                        // æœ€å¾Œã®ä»˜ä¸æ—¥ã‹ã‚‰1å¹´å¾Œ
                        var lastGrant = parseLocalDate(grants[grants.length - 1].grantDate);
                        lastGrant.setFullYear(lastGrant.getFullYear() + 1);
                        nextGrantStr = lastGrant.getFullYear() + '-' +
                            ('0' + (lastGrant.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + lastGrant.getDate()).slice(-2);
                    }

                    var nextExpiry = '-';
                    var expiringDays = 0;
                    if (grants.length > 0) {
                        var today = new Date();
                        var todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                        for (var i = 0; i < grants.length; i++) {
                            var expiry = parseLocalDate(grants[i].expiryDate);
                            if (expiry >= todayDate) {
                                nextExpiry = formatDate(grants[i].expiryDate);
                                var diffDays = Math.floor((expiry - todayDate) / (1000 * 60 * 60 * 24));
                                if (diffDays <= 30) {
                                    expiringDays = grants[i].days;
                                }
                                break;
                            }
                        }
                    }

                    var expiryClass = expiringDays > 0 ? 'text-danger' : '';
                    var expiryBold = expiringDays > 0 ? '<strong>' + expiringDays + '.0æ—¥</strong>' : '0æ—¥';
                    
                    // æ®‹æ—¥æ•°ã®èƒŒæ™¯è‰²ï¼ˆçµ±ä¸€ï¼‰
                    var remainingStyle = 'background: #e3f5ff; color: #0984e3; padding: 4px 8px; border-radius: 6px; font-weight: 700;';

                    html += '<tr class="' + retiredClass + '" ' + displayStyle + '>';
                    html += '<td><strong>' + emp.name + '</strong>' + retiredBadge + '</td>';
                    html += '<td>' + formatDate(emp.hireDate) + '</td>';
                    html += '<td>' + years.toFixed(1) + 'å¹´</td>';
                    html += '<td><span style="' + remainingStyle + '">' + result.remaining.toFixed(1) + 'æ—¥</span></td>';
                    html += '<td>' + formatDate(nextGrantStr) + '</td>';
                    html += '<td class="' + expiryClass + '">' + nextExpiry + '</td>';
                    html += '<td class="' + expiryClass + '">' + expiryBold + '</td>';
                    html += '<td>';
                    html += '<button class="action-btn-primary" onclick="showEmployeeDetail(' + emp.id + ')">è©³ç´°</button>';
                    html += '<button class="action-btn-secondary" onclick="showEditEmployeeModal(' + emp.id + ')">ç·¨é›†</button>';
                    html += '</td>';
                    html += '</tr>';
                } else {
                    html += '<tr class="' + retiredClass + '" ' + displayStyle + '>';
                    html += '<td><strong>' + emp.name + '</strong>' + retiredBadge + '</td>';
                    html += '<td>' + formatDate(emp.hireDate) + '</td>';
                    html += '<td>-</td><td>0æ—¥</td><td>-</td><td>-</td><td>-</td>';
                    html += '<td>';
                    html += '<button class="action-btn-primary" onclick="showEmployeeDetail(' + emp.id + ')">è©³ç´°</button>';
                    html += '<button class="action-btn-secondary" onclick="showEditEmployeeModal(' + emp.id + ')">ç·¨é›†</button>';
                    html += '</td>';
                    html += '</tr>';
                }
            });
            }

            tbody.innerHTML = html;
        }

        function renderRegisterHistory() {
            var tbody = document.getElementById('register-history-body');
            if (!tbody) return;

            var recentRecords = leaveRecords.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 5);

            var html = '';
            if (recentRecords.length === 0) {
                html = '<tr><td colspan="6" style="text-align: center; color: #999;">ç™»éŒ²å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                recentRecords.forEach(function(rec) {
                    var emp = getEmployeeById(rec.employeeId);
                    if (!emp) return;
                    var badge = rec.type === 1.0 ?
                        '<span class="badge badge-info">å…¨ä¼‘</span>' :
                        '<span class="badge badge-success">åŠä¼‘</span>';
                    html += '<tr>';
                    html += '<td>' + emp.name + '</td>';
                    html += '<td>' + formatDate(rec.date) + '</td>';
                    html += '<td>' + badge + '</td>';
                    html += '<td>' + rec.type.toFixed(1) + 'æ—¥</td>';
                    html += '<td>' + (rec.memo || '-') + '</td>';
                    html += '<td>';
                    html += '<button class="action-btn-secondary" onclick="showEditRecordModal(' + rec.id + ')">ä¿®æ­£</button>';
                    html += '<button class="action-btn action-btn-danger" onclick="deleteRecord(' + rec.id + ')">å–æ¶ˆ</button>';
                    html += '</td>';
                    html += '</tr>';
                });
            }
            tbody.innerHTML = html;
        }

        function showEmployeeDetail(employeeId) {
            currentEmployeeId = employeeId;
            var emp = getEmployeeById(employeeId);
            if (!emp) return;

            // ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.page').forEach(function(page) {
                page.classList.add('hidden');
            });
            document.getElementById('page-employee-detail').classList.remove('hidden');
            document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
                link.classList.remove('active');
            });
            window.scrollTo(0, 0);

            // åå‰ã‚’è¨­å®š
            document.getElementById('employee-detail-name').textContent = emp.name;

            // ãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—
            var today = new Date();
            var years = calculateYearsOfService(emp.hireDate);
            var grants = generateLeaveGrants(emp.hireDate);
            var records = getRecordsByEmployeeId(employeeId);
            var result = calculateRemainingDays(employeeId);
            var totalGranted = grants.reduce(function(s, g) { return s + g.days; }, 0);
            totalGranted = Math.min(totalGranted, 40);
            var totalUsed = records.reduce(function(s, r) { return s + r.type; }, 0);

            // ä»Šæœˆã®æ¶ˆåŒ–
            var thisMonthUsed = records.filter(function(r) {
                var d = parseLocalDate(r.date);
                return d.getMonth() === today.getMonth() && d.getFullYear() === today.getFullYear();
            }).reduce(function(s, r) { return s + r.type; }, 0);

            // æ¬¡å›ä»˜ä¸æ—¥ã¨æ—¥æ•°
            var nextGrantStr = '-';
            var nextGrantDays = 0;
            if (grants.length === 0) {
                var fg = parseLocalDate(emp.hireDate);
                fg.setMonth(fg.getMonth() + 6);
                nextGrantStr = fg.getFullYear() + '-' + ('0'+(fg.getMonth()+1)).slice(-2) + '-' + ('0'+fg.getDate()).slice(-2);
                nextGrantDays = getLeaveDaysByYears(0.5);
            } else {
                var lg = parseLocalDate(grants[grants.length - 1].grantDate);
                lg.setFullYear(lg.getFullYear() + 1);
                nextGrantStr = lg.getFullYear() + '-' + ('0'+(lg.getMonth()+1)).slice(-2) + '-' + ('0'+lg.getDate()).slice(-2);
                nextGrantDays = getLeaveDaysByYears(grants[grants.length - 1].years + 1);
            }

            var infoStyle = 'font-size: 16px; font-weight: 600; color: #1a1a1a; margin-top: 4px;';

            var html = '';

            // åŸºæœ¬æƒ…å ±
            html += '<div class="card">';
            html += '<h2 class="card-title">åŸºæœ¬æƒ…å ±</h2>';
            html += '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">';
            html += '<div><div class="stat-label">å…¥ç¤¾æ—¥</div><div style="' + infoStyle + '">' + formatDate(emp.hireDate) + '</div></div>';
            html += '<div><div class="stat-label">å‹¤ç¶šå¹´æ•°</div><div style="' + infoStyle + '">' + years.toFixed(1) + 'å¹´</div></div>';
            html += '<div><div class="stat-label">æ¬¡å›ä»˜ä¸äºˆå®š</div><div style="' + infoStyle + '">' + formatDate(nextGrantStr) + 'ï¼ˆ' + nextGrantDays + 'æ—¥ï¼‰</div></div>';
            html += '</div></div>';

            // æœ‰çµ¦æ®‹æ•°ã‚«ãƒ¼ãƒ‰
            html += '<div class="stats-grid">';
            html += '<div class="stat-card"><div class="stat-label">æ®‹æ—¥æ•°</div><div class="stat-value">' + result.remaining.toFixed(1) + '<span class="stat-unit">æ—¥</span></div></div>';
            html += '<div class="stat-card"><div class="stat-label">ä»˜ä¸ç·æ•°ï¼ˆæœ‰åŠ¹åˆ†ï¼‰</div><div class="stat-value">' + totalGranted.toFixed(1) + '<span class="stat-unit">æ—¥</span></div></div>';
            html += '<div class="stat-card"><div class="stat-label">æ¶ˆåŒ–æ¸ˆã¿ï¼ˆç´¯è¨ˆï¼‰</div><div class="stat-value">' + totalUsed.toFixed(1) + '<span class="stat-unit">æ—¥</span></div></div>';
            html += '<div class="stat-card"><div class="stat-label">ä»Šæœˆã®æ¶ˆåŒ–</div><div class="stat-value">' + thisMonthUsed.toFixed(1) + '<span class="stat-unit">æ—¥</span></div></div>';
            html += '</div>';

            // æœˆåˆ¥æ¶ˆåŒ–ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰
            var hireYear = parseInt(emp.hireDate.split('-')[0]);
            var currentYear = today.getFullYear();
            var yearOptions = '';
            for (var y = currentYear; y >= hireYear; y--) {
                var selected = y === currentYear ? 'selected' : '';
                yearOptions += '<option value="' + y + '" ' + selected + '>' + y + 'å¹´</option>';
            }
            html += '<div class="card">';
            html += '<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">';
            html += '<h2 class="card-title" style="margin:0;">æœˆåˆ¥æ¶ˆåŒ–æ—¥æ•°</h2>';
            html += '<select id="monthly-year-select" class="form-input" style="width:120px;" onchange="renderMonthlyTable(' + employeeId + ')">';
            html += yearOptions;
            html += '</select>';
            html += '</div>';
            html += '<div id="monthly-table-container"></div>';
            html += '</div>';

            // æœŸé™åˆ¥æ®‹æ•°
            html += '<div class="card"><h2 class="card-title">æœŸé™åˆ¥æ®‹æ•°</h2>';
            html += '<table class="data-table"><thead><tr><th>ä»˜ä¸æ—¥</th><th>ä»˜ä¸æ—¥æ•°</th><th>å¤±åŠ¹æ—¥</th><th>ã‚ã¨ä½•æ—¥</th><th>çŠ¶æ…‹</th></tr></thead><tbody>';
            if (grants.length === 0) {
                html += '<tr><td colspan="5" style="text-align:center;color:#999;">ã¾ã ä»˜ä¸ã•ã‚Œã¦ã„ã¾ã›ã‚“</td></tr>';
            } else {
                grants.slice().reverse().forEach(function(g) {
                    var expiry = parseLocalDate(g.expiryDate);
                    var daysUntil = Math.floor((expiry - today) / (1000 * 60 * 60 * 24));
                    var isExpired = expiry < today;
                    var isUrgent = !isExpired && daysUntil <= 30;
                    var isMedium = !isExpired && daysUntil <= 90;
                    var cls = isExpired ? 'color:#aaa;' : (isUrgent ? 'color:#d63031;' : (isMedium ? 'color:#e67e22;' : ''));
                    var badge = isExpired ?
                        '<span class="badge badge-secondary">å¤±åŠ¹</span>' :
                        (isUrgent ? '<span class="badge badge-danger">30æ—¥ä»¥å†…</span>' : '<span class="badge badge-success">æœ‰åŠ¹</span>');
                    html += '<tr>';
                    html += '<td style="' + cls + '">' + formatDate(g.grantDate) + '</td>';
                    html += '<td style="' + cls + '">' + g.days + 'æ—¥</td>';
                    html += '<td style="' + cls + '">' + formatDate(g.expiryDate) + '</td>';
                    html += '<td style="' + cls + '">' + (isExpired ? 'å¤±åŠ¹æ¸ˆã¿' : daysUntil + 'æ—¥') + '</td>';
                    html += '<td>' + badge + '</td>';
                    html += '</tr>';
                });
            }
            html += '</tbody></table></div>';

            // æ¶ˆåŒ–å±¥æ­´
            html += '<div class="card"><h2 class="card-title">æ¶ˆåŒ–å±¥æ­´</h2>';
            html += '<table class="data-table"><thead><tr><th>æ—¥ä»˜</th><th>ç¨®é¡</th><th>å†…å®¹</th><th>å¤‰å‹•</th><th>ç†ç”±</th><th>æ“ä½œ</th></tr></thead><tbody>';
            var sortedRecords = records.slice().sort(function(a, b) { return new Date(b.date) - new Date(a.date); });
            if (sortedRecords.length === 0) {
                html += '<tr><td colspan="6" style="text-align:center;color:#999;">æ¶ˆåŒ–å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                sortedRecords.forEach(function(r) {
                    var typeText = r.type === 1.0 ? 'å…¨ä¼‘' : 'åŠä¼‘';
                    html += '<tr>';
                    html += '<td>' + formatDate(r.date) + '</td>';
                    html += '<td><span class="badge badge-info">æ¶ˆåŒ–</span></td>';
                    html += '<td>' + formatDate(r.date) + 'ã®æœ‰çµ¦æ¶ˆåŒ–ï¼ˆ' + typeText + 'ï¼‰</td>';
                    html += '<td class="text-danger">-' + r.type.toFixed(1) + 'æ—¥</td>';
                    html += '<td>' + (r.memo || '-') + '</td>';
                    html += '<td>';
                    html += '<button class="action-btn-secondary" onclick="showEditRecordModal(' + r.id + ')">ä¿®æ­£</button>';
                    html += '<button class="action-btn action-btn-danger" onclick="deleteRecordFromDetail(' + r.id + ',' + employeeId + ')">å–æ¶ˆ</button>';
                    html += '</td>';
                    html += '</tr>';
                });
            }
            html += '</tbody></table></div>';

            document.getElementById('employee-detail-body').innerHTML = html;

            // æœˆåˆ¥æ¶ˆåŒ–ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆæœŸæç”»
            renderMonthlyTable(employeeId);
        }

        function renderMonthlyTable(employeeId) {
            var select = document.getElementById('monthly-year-select');
            var container = document.getElementById('monthly-table-container');
            if (!select || !container) return;

            var year = parseInt(select.value);
            var records = getRecordsByEmployeeId(employeeId);
            var today = new Date();

            // æœˆã”ã¨ã®é›†è¨ˆ
            var monthlyData = [];
            var yearTotal = 0;
            for (var m = 1; m <= 12; m++) {
                var monthRecords = records.filter(function(r) {
                    var d = parseLocalDate(r.date);
                    return d.getFullYear() === year && d.getMonth() + 1 === m;
                });
                var days = monthRecords.reduce(function(s, r) { return s + parseFloat(r.type); }, 0);
                var isFuture = year > today.getFullYear() || (year === today.getFullYear() && m > today.getMonth() + 1);
                monthlyData.push({ month: m, days: days, isFuture: isFuture });
                yearTotal += days;
            }

            var html = '<table class="data-table">';
            html += '<thead><tr><th>æœˆ</th><th>æ¶ˆåŒ–æ—¥æ•°</th><th>å†…è¨³</th></tr></thead><tbody>';

            monthlyData.forEach(function(item) {
                var records_m = records.filter(function(r) {
                    var d = parseLocalDate(r.date);
                    return d.getFullYear() === year && d.getMonth() + 1 === item.month;
                });

                // å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå…¨ä¼‘/åŠä¼‘ã®ä»¶æ•°ï¼‰
                var fullCount  = records_m.filter(function(r) { return parseFloat(r.type) === 1.0; }).length;
                var halfCount  = records_m.filter(function(r) { return parseFloat(r.type) === 0.5; }).length;
                var breakdown  = '';
                if (fullCount > 0) breakdown += 'å…¨ä¼‘Ã—' + fullCount;
                if (halfCount > 0) breakdown += (breakdown ? 'ã€€' : '') + 'åŠä¼‘Ã—' + halfCount;
                if (!breakdown && !item.isFuture) breakdown = '-';
                if (item.isFuture) breakdown = 'ï¼';

                var isCurrentMonth = year === today.getFullYear() && item.month === today.getMonth() + 1;
                var rowStyle = isCurrentMonth ? 'background:#f0f7ff;font-weight:600;' : '';
                var daysStyle = item.days > 0 ? 'color:#0984e3;font-weight:700;' : 'color:#ccc;';

                html += '<tr style="' + rowStyle + '">';
                html += '<td>' + item.month + 'æœˆ' + (isCurrentMonth ? ' <span style="font-size:11px;color:#0984e3;">ï¼ˆä»Šæœˆï¼‰</span>' : '') + '</td>';
                html += '<td style="' + daysStyle + '">' + (item.days > 0 ? item.days.toFixed(1) + 'æ—¥' : '0æ—¥') + '</td>';
                html += '<td style="color:#888;font-size:13px;">' + breakdown + '</td>';
                html += '</tr>';
            });

            // å¹´é–“åˆè¨ˆè¡Œ
            html += '<tr style="border-top:2px solid #e0e0e0;font-weight:700;background:#f7f9fa;">';
            html += '<td>åˆè¨ˆ</td>';
            html += '<td style="color:#0984e3;">' + yearTotal.toFixed(1) + 'æ—¥</td>';
            html += '<td style="color:#888;font-size:13px;">å¹´é–“5æ—¥ç¾©å‹™ï¼š' + (yearTotal >= 5 ? '<span style="color:#00b894;">âœ… é”æˆï¼ˆ' + yearTotal.toFixed(1) + 'æ—¥ï¼‰</span>' : '<span style="color:#d63031;">âš ï¸ æœªé”æˆï¼ˆã‚ã¨' + (5 - yearTotal).toFixed(1) + 'æ—¥å¿…è¦ï¼‰</span>') + '</td>';
            html += '</tr>';

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function deleteRecordFromDetail(recordId, employeeId) {
            if (confirm('ã“ã®æœ‰çµ¦ç™»éŒ²ã‚’å–ã‚Šæ¶ˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                supabase.from('leave_records').delete().eq('id', recordId).then(function(result) {
                    if (result.error) { alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                    loadData();
                    setTimeout(function() { showEmployeeDetail(employeeId); }, 500);
                });
            }
        }

        function showEditRecordModal(recordId) {
            var rec = leaveRecords.find(function(r) { return r.id === recordId; });
            if (!rec) return;
            var emp = getEmployeeById(rec.employeeId);
            if (!emp) return;

            document.getElementById('edit-record-employee-name').value = emp.name;
            document.getElementById('edit-record-date').value = rec.date;
            document.getElementById('edit-record-type-value').value = rec.type;
            document.getElementById('edit-record-memo').value = rec.memo || '';

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('#edit-record-modal .leave-type-btn-inline').forEach(function(btn) {
                btn.classList.remove('active');
                if (parseFloat(btn.getAttribute('data-value')) === rec.type) {
                    btn.classList.add('active');
                }
            });

            document.getElementById('edit-record-modal').setAttribute('data-record-id', recordId);
            document.getElementById('edit-record-modal').classList.add('active');
        }

        function selectEditRecordType(button) {
            document.querySelectorAll('#edit-record-modal .leave-type-btn-inline').forEach(function(btn) {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            document.getElementById('edit-record-type-value').value = button.getAttribute('data-value');
        }

        function confirmDeleteRecord() {
            var recordId = parseInt(document.getElementById('edit-record-modal').getAttribute('data-record-id'));
            if (confirm('ã“ã®æœ‰çµ¦ç™»éŒ²ã‚’å–ã‚Šæ¶ˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                supabase.from('leave_records').delete().eq('id', recordId).then(function(result) {
                    if (result.error) { alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                    closeModal('edit-record-modal');
                    loadData();
                    alert('æœ‰çµ¦ç™»éŒ²ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
                });
            }
        }

        function editRecord(e) {
            e.preventDefault();
            var recordId = parseInt(document.getElementById('edit-record-modal').getAttribute('data-record-id'));
            supabase.from('leave_records').update({
                date: document.getElementById('edit-record-date').value,
                type: parseFloat(document.getElementById('edit-record-type-value').value),
                memo: document.getElementById('edit-record-memo').value
            }).eq('id', recordId).then(function(result) {
                if (result.error) { alert('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                closeModal('edit-record-modal');
                loadData();
                alert('æœ‰çµ¦ç™»éŒ²ã‚’ä¿®æ­£ã—ã¾ã—ãŸ');
            });
        }

        function renderHistory() {
            var tbody = document.getElementById('history-body');
            if (!tbody) return;

            var allRecords = leaveRecords.slice().sort(function(a, b) {
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            var html = '';
            if (allRecords.length === 0) {
                html = '<tr><td colspan="6" style="text-align: center; color: #999; padding: 40px;">æ¶ˆåŒ–å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                allRecords.forEach(function(rec) {
                    var emp = getEmployeeById(rec.employeeId);
                    if (!emp) return;
                    var createdDate = new Date(rec.createdAt);
                    var dateStr = formatDate(rec.createdAt.split('T')[0]) + ' ' +
                        ('0' + createdDate.getHours()).slice(-2) + ':' +
                        ('0' + createdDate.getMinutes()).slice(-2);
                    var typeText = rec.type === 1.0 ? 'æœ‰çµ¦æ¶ˆåŒ–' : 'æœ‰çµ¦æ¶ˆåŒ–ï¼ˆåŠä¼‘ï¼‰';
                    html += '<tr>';
                    html += '<td>' + dateStr + '</td>';
                    html += '<td>' + emp.name + '</td>';
                    html += '<td><span class="badge badge-info">æ¶ˆåŒ–</span></td>';
                    html += '<td>' + formatDate(rec.date) + 'ã®' + typeText + '</td>';
                    html += '<td class="text-danger">-' + rec.type.toFixed(1) + 'æ—¥</td>';
                    html += '<td>' + (rec.memo || '-') + '</td>';
                    html += '</tr>';
                });
            }
            tbody.innerHTML = html;
        }

        function renderExpiring() {
            var tbody = document.getElementById('expiring-body');
            var alertDiv = document.getElementById('expiring-alert');
            if (!tbody) return;

            var today = new Date();
            var todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            var expiringList = [];

            employeesData.filter(function(emp) {
                return emp.status === 'active';
            }).forEach(function(emp) {
                var grants = generateLeaveGrants(emp.hireDate);
                grants.forEach(function(grant) {
                    var expiryDate = parseLocalDate(grant.expiryDate);
                    var daysUntil = Math.floor((expiryDate - todayDate) / (1000 * 60 * 60 * 24));
                    if (expiryDate >= todayDate) {
                        expiringList.push({
                            employee: emp,
                            expiryDate: grant.expiryDate,
                            grantDate: grant.grantDate,
                            days: grant.days,
                            daysUntil: daysUntil,
                            years: grant.years
                        });
                    }
                });
            });

            expiringList.sort(function(a, b) { return a.daysUntil - b.daysUntil; });

            var urgentCount = expiringList.filter(function(item) {
                return item.daysUntil <= 30;
            }).length;

            if (alertDiv) {
                if (urgentCount > 0) {
                    alertDiv.innerHTML = '<div class="alert alert-danger"><strong>âš ï¸ ç·Šæ€¥ï¼š</strong> ' + urgentCount + 'ä»¶ã®æœ‰çµ¦ãŒ30æ—¥ä»¥å†…ã«å¤±åŠ¹äºˆå®šã§ã™</div>';
                    alertDiv.style.display = '';
                } else {
                    alertDiv.style.display = 'none';
                }
            }

            var html = '';
            if (expiringList.length === 0) {
                html = '<tr><td colspan="6" style="text-align: center; color: #999; padding: 40px;">å¤±åŠ¹äºˆå®šã®æœ‰çµ¦ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            } else {
                expiringList.forEach(function(item) {
                    var isUrgent = item.daysUntil <= 30;
                    var dateClass = isUrgent ? 'text-danger' : (item.daysUntil <= 90 ? 'text-warning' : '');
                    var badge = isUrgent ?
                        '<span class="badge badge-danger">30æ—¥ä»¥å†…</span>' :
                        '<span class="badge badge-success">æœ‰åŠ¹</span>';
                    html += '<tr>';
                    html += '<td><strong>' + item.employee.name + '</strong></td>';
                    html += '<td class="' + dateClass + '">' + formatDate(item.expiryDate) + '</td>';
                    html += '<td class="' + dateClass + '">' + item.days.toFixed(1) + 'æ—¥</td>';
                    html += '<td>' + formatDate(item.grantDate) + 'ä»˜ä¸ï¼ˆå‹¤ç¶š' + item.years + 'å¹´ï¼‰</td>';
                    html += '<td class="' + dateClass + '">' + item.daysUntil + 'æ—¥</td>';
                    html += '<td>' + badge + '</td>';
                    html += '</tr>';
                });
            }
            tbody.innerHTML = html;
        }

        function showAddEmployeeModal() {
            document.getElementById('add-employee-modal').classList.add('active');
            document.getElementById('add-employee-form').reset();
        }

        function showEditEmployeeModal(employeeId) {
            var emp = getEmployeeById(employeeId);
            if (!emp) return;

            document.getElementById('edit-employee-name').value = emp.name;
            document.getElementById('edit-employee-kana').value = emp.kana;
            document.getElementById('edit-employee-date').value = emp.hireDate;
            document.getElementById('edit-employee-status').value = emp.status;
            document.getElementById('edit-employee-retirement-date').value = emp.retirementDate || '';
            document.getElementById('edit-employee-memo').value = emp.memo || '';

            document.getElementById('edit-employee-modal').classList.add('active');
            document.getElementById('edit-employee-modal').setAttribute('data-employee-id', employeeId);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addEmployee(e) {
            e.preventDefault();
            var name     = document.getElementById('add-employee-name').value;
            var kana     = document.getElementById('add-employee-kana').value;
            var hireDate = document.getElementById('add-employee-date').value;

            supabase.from('employees').insert([{
                name: name, kana: kana, hire_date: hireDate,
                status: 'active', memo: ''
            }]).select().then(function(result) {
                if (result.error) { alert('è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                closeModal('add-employee-modal');
                loadData();
                alert('å¾“æ¥­å“¡ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            });
        }

        function editEmployee(e) {
            e.preventDefault();
            var employeeId = parseInt(document.getElementById('edit-employee-modal').getAttribute('data-employee-id'));
            var status = document.getElementById('edit-employee-status').value;
            var retirementDate = document.getElementById('edit-employee-retirement-date').value || null;

            supabase.from('employees').update({
                name:            document.getElementById('edit-employee-name').value,
                kana:            document.getElementById('edit-employee-kana').value,
                hire_date:       document.getElementById('edit-employee-date').value,
                status:          status,
                retirement_date: retirementDate,
                memo:            document.getElementById('edit-employee-memo').value
            }).eq('id', employeeId).then(function(result) {
                if (result.error) { alert('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                closeModal('edit-employee-modal');
                loadData();
                alert('å¾“æ¥­å“¡æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            });
        }

        function deleteEmployee() {
            var employeeId = parseInt(document.getElementById('edit-employee-modal').getAttribute('data-employee-id'));
            if (confirm('ã“ã®å¾“æ¥­å“¡ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nâ€» æœ‰çµ¦ã®å±¥æ­´ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                supabase.from('employees').delete().eq('id', employeeId).then(function(result) {
                    if (result.error) { alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                    closeModal('edit-employee-modal');
                    loadData();
                    alert('å¾“æ¥­å“¡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                });
            }
        }

        function registerLeave(e) {
            e.preventDefault();
            var employeeId = parseInt(document.getElementById('employee-select').value);
            var date       = document.getElementById('leave-date').value;
            var type       = parseFloat(document.getElementById('leave-type-value').value);
            var memo       = document.getElementById('leave-memo').value;

            if (!employeeId || !date) {
                alert('å¾“æ¥­å“¡ã¨æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            var emp = getEmployeeById(employeeId);
            supabase.from('leave_records').insert([{
                employee_id: employeeId,
                date: date,
                type: type,
                memo: memo
            }]).then(function(result) {
                if (result.error) { alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error.message); return; }
                alert('æœ‰çµ¦ã‚’ç™»éŒ²ã—ã¾ã—ãŸ\nå¾“æ¥­å“¡: ' + emp.name + '\næ—¥ä»˜: ' + formatDate(date) + '\nåŒºåˆ†: ' + type + 'æ—¥');
                document.getElementById('register-form').reset();
                resetLeaveTypeButtons();
                loadData();
            });
        }

        function selectLeaveType(button) {
            document.querySelectorAll('.leave-type-btn-inline').forEach(function(btn) {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            var value = button.getAttribute('data-value');
            document.getElementById('leave-type-value').value = value;
        }

        function resetLeaveTypeButtons() {
            document.querySelectorAll('.leave-type-btn-inline').forEach(function(btn, index) {
                if (index === 0) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            document.getElementById('leave-type-value').value = '1.0';
        }

        function toggleRetiredEmployees() {
            var checkbox = document.getElementById('show-retired');
            var retiredRows = document.querySelectorAll('.retired-employee');

            retiredRows.forEach(function(row) {
                if (checkbox.checked) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function exportEmployeeCSV() {
            if (!currentEmployeeId) return;

            var emp = getEmployeeById(currentEmployeeId);
            var records = getRecordsByEmployeeId(currentEmployeeId);
            var result = calculateRemainingDays(currentEmployeeId);

            var data = [
                ['å¾“æ¥­å“¡å', emp.name],
                ['ãƒ•ãƒªã‚¬ãƒŠ', emp.kana],
                ['å…¥ç¤¾æ—¥', formatDate(emp.hireDate)],
                [''],
                ['æ®‹æ—¥æ•°', result.remaining.toFixed(1) + 'æ—¥'],
                [''],
                ['â–  æ¶ˆåŒ–å±¥æ­´'],
                ['æ—¥ä»˜', 'åŒºåˆ†', 'ãƒ¡ãƒ¢']
            ];

            records.forEach(function(rec) {
                data.push([
                    formatDate(rec.date),
                    rec.type + 'æ—¥',
                    rec.memo
                ]);
            });

            var csv = data.map(function(row) {
                return row.map(function(cell) {
                    return '"' + cell + '"';
                }).join(',');
            }).join('\n');

            var bom = '\uFEFF';
            var blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = emp.name + '_æœ‰çµ¦ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }

        function downloadSampleCSV() {
            var bom = '\uFEFF';
            var csv = 'æ°å,ãƒ•ãƒªã‚¬ãƒŠ,å…¥ç¤¾æ—¥,æ¶ˆåŒ–æ—¥,æ¶ˆåŒ–åŒºåˆ†,ãƒ¡ãƒ¢\n';
            csv += 'å±±ç”° å¤ªéƒ,ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦,2022-04-01,2025-02-10,å…¨ä¼‘,ç§ç”¨\n';
            csv += 'å±±ç”° å¤ªéƒ,ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦,2022-04-01,2025-01-20,åŠä¼‘,é€šé™¢\n';
            csv += 'ä½è—¤ èŠ±å­,ã‚µãƒˆã‚¦ ãƒãƒŠã‚³,2019-10-01,,, \n';
            var blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'sample_import.csv';
            link.click();
        }

        function importCSV() {
            var fileInput = document.getElementById('csv-file-input');
            var file = fileInput.files[0];
            if (!file) { alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }

            showLoading();
            
            var reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    var text = e.target.result.replace(/^\uFEFF/, '');
                    var lines = text.split('\n').filter(function(l) { return l.trim() !== ''; });
                    if (lines.length < 2) { alert('ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™'); hideLoading(); return; }

                    var empCache = {};

                    // CSVã‚’è§£æ
                    for (var i = 1; i < lines.length; i++) {
                        var cols = lines[i].split(',').map(function(c) { return c.trim().replace(/^"|"$/g, ''); });
                        var name = cols[0]; var kana = cols[1] || ''; var hireDate = cols[2];
                        var consumeDate = cols[3]; var consumeType = cols[4]; var memo = cols[5] || '';
                        if (!name || !hireDate) continue;
                        var key = name + '_' + hireDate;
                        if (!empCache[key]) empCache[key] = { name: name, kana: kana, hireDate: hireDate, records: [] };
                        if (consumeDate) {
                            empCache[key].records.push({ date: consumeDate, type: consumeType === 'åŠä¼‘' ? 0.5 : 1.0, memo: memo });
                        }
                    }

                    var empKeys = Object.keys(empCache);
                    if (empKeys.length === 0) { alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'); hideLoading(); return; }

                    // å¾“æ¥­å“¡ã”ã¨ã«é †æ¬¡å‡¦ç†
                    for (var idx = 0; idx < empKeys.length; idx++) {
                        var key = empKeys[idx];
                        var item = empCache[key];
                        
                        // æ—¢å­˜ãƒã‚§ãƒƒã‚¯
                        var result = await supabase.from('employees').select('id').eq('name', item.name).eq('hire_date', item.hireDate);
                        
                        var empId;
                        if (result.data && result.data.length > 0) {
                            empId = result.data[0].id;
                        } else {
                            // æ–°è¦å¾“æ¥­å“¡ã‚’ä½œæˆ
                            var r2 = await supabase.from('employees').insert([{ name: item.name, kana: item.kana, hire_date: item.hireDate, status: 'active', memo: '' }]).select();
                            if (r2.data && r2.data.length > 0) {
                                empId = r2.data[0].id;
                            }
                        }
                        
                        // æ¶ˆåŒ–ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é †ç•ªã«1ä»¶ãšã¤æŒ¿å…¥
                        if (empId && item.records.length > 0) {
                            for (var j = 0; j < item.records.length; j++) {
                                var rec = item.records[j];
                                await supabase.from('leave_records').insert([{ employee_id: empId, date: rec.date, type: rec.type, memo: rec.memo }]);
                            }
                        }
                    }
                    
                    hideLoading();
                    await loadData();
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ã—ã¾ã—ãŸï¼ˆ' + empKeys.length + 'åã€å…¨' + lines.length + 'ä»¶ï¼‰');
                    
                } catch (error) {
                    hideLoading();
                    console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function exportCSV() {
            if (employeesData.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            var bom = '\uFEFF';
            var rows = [['æ°å', 'ãƒ•ãƒªã‚¬ãƒŠ', 'å…¥ç¤¾æ—¥', 'åœ¨ç±çŠ¶æ³', 'æ®‹æ—¥æ•°', 'æ¶ˆåŒ–æ—¥', 'æ¶ˆåŒ–åŒºåˆ†', 'ãƒ¡ãƒ¢']];
            employeesData.forEach(function(emp) {
                var result = calculateRemainingDays(emp.id);
                var records = getRecordsByEmployeeId(emp.id);
                if (records.length === 0) {
                    rows.push([emp.name, emp.kana, emp.hireDate, emp.status === 'active' ? 'åœ¨ç±' : 'é€€ç¤¾æ¸ˆã¿', result.remaining.toFixed(1), '', '', '']);
                } else {
                    records.forEach(function(rec) {
                        rows.push([emp.name, emp.kana, emp.hireDate, emp.status === 'active' ? 'åœ¨ç±' : 'é€€ç¤¾æ¸ˆã¿', result.remaining.toFixed(1), rec.date, rec.type === 1.0 ? 'å…¨ä¼‘' : 'åŠä¼‘', rec.memo || '']);
                    });
                }
            });
            var csv = rows.map(function(row) {
                return row.map(function(cell) { return '"' + cell + '"'; }).join(',');
            }).join('\n');
            var blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'æœ‰çµ¦ç®¡ç†ãƒ‡ãƒ¼ã‚¿_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }

        function backupData() {
            var backup = {
                exportedAt: new Date().toISOString(),
                employees: employeesData,
                records: leaveRecords
            };
            var blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'æœ‰çµ¦ç®¡ç†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
        }

        function resetAllData() {
            if (confirm('æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»å…¨å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿\nãƒ»å…¨æœ‰çµ¦æ¶ˆåŒ–å±¥æ­´\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                supabase.from('leave_records').delete().neq('id', 0).then(function() {
                    supabase.from('employees').delete().neq('id', 0).then(function() {
                        loadData();
                        alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
                    });
                });
            }
        }

        function setupEventListeners() {
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šä¸­...');
            
            document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    var pageId = this.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                    }
                });
            });

            var registerForm = document.getElementById('register-form');
            if (registerForm) {
                console.log('æœ‰çµ¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                registerForm.addEventListener('submit', registerLeave);
            } else {
                console.log('è­¦å‘Š: æœ‰çµ¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }

            var addEmployeeForm = document.getElementById('add-employee-form');
            if (addEmployeeForm) {
                console.log('å¾“æ¥­å“¡è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                addEmployeeForm.addEventListener('submit', addEmployee);
            } else {
                console.log('è­¦å‘Š: å¾“æ¥­å“¡è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }

            var editEmployeeForm = document.getElementById('edit-employee-form');
            if (editEmployeeForm) {
                console.log('å¾“æ¥­å“¡ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                editEmployeeForm.addEventListener('submit', editEmployee);
            } else {
                console.log('è­¦å‘Š: å¾“æ¥­å“¡ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }

            var editRecordForm = document.getElementById('edit-record-form');
            if (editRecordForm) {
                editRecordForm.addEventListener('submit', editRecord);
            }

            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== æœ‰çµ¦ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ èµ·å‹• ===');
            
            initSystem();
        });
    </script>
</div><!-- /app-screen -->
</body>
</html>
